[{"contents":"","lang":"en","permalink":"/","title":""},{"contents":"How it came to be One day I came accross a video on youtube explaining how you can use a phone as a server. That\u0026rsquo;s correct, servers are just computers that are custom made for a specific need. The processors usually have more cores which run at lower frequencies, they support high speed networking, support for redundant storage and a lot of it, etc. At its core though as long as we\u0026rsquo;re talking about a small home server a lot of devices could easily pull running lightweight services such as file sharing services, home automation, video streaming and more. This got me to thinking why is it not common sense to reuse old phones this way? Almost everyone has an old one laying around which becomes useless e-waste. Let\u0026rsquo;s explore the topic together\n!!! info \u0026ldquo;Fun fact about e-waste\u0026rdquo; collapsible More and more old phones occupy drawers or landfills year after year which sparked an idea of quantifying how much. Nearly 1.5 billion phones are sold every year which makes 1.5b others waste most likely. I like to visualize such numbers by comparing them to tangible things (not a revolutionary concept but it works great for me). So I headed to chatgpt to ask it to compare the volume of 1.5b average sized phones to olympic pools. The result is 50 olympic swimming pools a year full of abandoned and mostly unrecycled smartphones. I dont know where these swimming pools are but that\u0026rsquo;s besides the point. After all of this the takeaway is read this article or the ghosts of your past phones will haunt you forever. :sentiment satisfied:\n!!! note \u0026ldquo;Note to the readers\u0026rdquo; This article shows my research regarding the topic not a tutorial on a one size fits all ultra performant cheap home server. If you want to learn about what such a project will achieve in the end you can jump straight to TODO: ADD LINK TO CONSIDERATIONS PART or HERE ADD THE DOWNSIDES OR SOMETHING.\nConsiderations Considering that a phone can\u0026rsquo;t fully provide what a server computer can for this purpose I needed to set some objectives and keep in mind some compromises.\nI want in some way to keep the phone powered on all the time without destroying its battery. I might need some external cooler if things get hot. Past this point the phone might get bricked while messing with it. The odds are low but they\u0026rsquo;re there. Service quality will be affected by the maximum wifi connection speed of my router. All in all it shouldn\u0026rsquo;t be a problem though as long as its not in the opposite side of the house from the router and im not transmitting gigabytes of data for many people at the same time. This phone could fail for any reason and we can\u0026rsquo;t even have storage redundancy. Backups will be a must and services won\u0026rsquo;t be critical (storing personal photos or password manager services and the likes are a no). In my case I could host something like a note taking app which is fine given that there\u0026rsquo;s daily backups and what would be lost in a day wouldn\u0026rsquo;t matter much. For any reason this project might fail and there have been many such moments where it felt like it. Primarily I intended to learn more and try to achieve the goal the best way I can. Supplying power I wanted to get this out of the way first because if the project would be viable i\u0026rsquo;d waste a ton of time trying out some new services on the phone and optimizing it. As a principle I should\u0026rsquo;ve started with the VM that will run the services and improve later upon it in case it doesn\u0026rsquo;t work at all. My old phone, a beautiful xiaomi redmi k20 pro was laying around waiting for me. It sounded like a good idea to remove the battery and find a way to connect it directly with a power source since it will run 24/7 either way. First problem it wont even power on because last time i was using it i managed to mess up something in the recovery so there was a weird procedure to boot it up. Second problem, trying to find a way to have uninterrupted power while accounting for voltage fluctuations that might fry the phone processor and some sort of battery isn\u0026rsquo;t that simple or cheap. If I go the DIY route i\u0026rsquo;d have to have to spend some time to be able to craft the entire \u0026ldquo;circuit\u0026rdquo; myself and it would take a lot of space. On the other hand just getting a UPS was pretty costly (~50$) considering how useful this device will be and how little it\u0026rsquo;s worth itself. My priorities are on the software side of things so I decided to stick to the UPS idea. I was ready to pull the trigger on the purchase either way i could use it for another device if it\u0026rsquo;s not useful for this project. The same day I read online that phone chargers are pretty durable even though the cables aren\u0026rsquo;t. Chargers can deal with voltage fluctuations, have failsafes which make them stop working in case something is wrong and are generally safe so long as I wasn\u0026rsquo;t using something crazy like my other 120W brick all day. The main issue would be that it shouldn\u0026rsquo;t keep charging non stop, that would fry the battery and cause the charger to fail. Some ROMs let you tweak the way the battery is charged and if that\u0026rsquo;s not the case for the one I find, I know of some apps that do achieve this if you\u0026rsquo;re rooted. What about the phone though, it won\u0026rsquo;t turn on. I tried booting it to recovery, system and fastboot to no avail. After attempting for a couple of days i grabbed another phone sitting in a drawer, a samsung galaxy s8 which has a cracked screen but works fine. 60hz screens seems so slow nowadays but otherwise the performance is solid and the battery health is good. TLDR: Phone gets electricity from phone charger as per usual I guess.\nPreparing the phone Most of the preparation steps I undertook can be skipped but will make a difference.\nInstalling a custom ROM If you\u0026rsquo;re lucky you can bring the phone up to date with recent developments by wasting a couple of hours on xda forums trying to find a custom ROM. This is a way to get latest updates for your oldie therefore efficiency and security improve while more features are available amongst other things. While I\u0026rsquo;m at it I could also unlock root access which would allow me to tweak the phone more. It took me more than I\u0026rsquo;d like to admit but I found out that lineageOS still supports the galaxy s8 to this day. Boot up Odin, unlock the bootloader, flash a custom recovery, boot into recovery, wipe everything, install the os and here we go. First boot seemed great, took some more time to root it and then I was off to customizing it.\nUtility apps I installed a custom F-Droid client to get open source apps which usually really helps to tweak your phone especially in such scenarios. Time to go through what i installed and what each app does:\nCanta - Remove any app even system services. Generally useful for removing preinstalled apps that you can\u0026rsquo;t remove. It categorizes apps as reccomended, advanced, expert which helps you remove things that won\u0026rsquo;t break the functionality unless you know what you\u0026rsquo;re doing. Very safe if you stick to removing reccomended apps. Shizuku - A new way to run apps that require root if you haven\u0026rsquo;t rooted your phone or dont want to give full control over your phone to apps. It just gives access to low level android APIs when requested which is what most of these apps need either way. Battery Charge Limit - Simple and powerful app that fixes my issue with charging. Battery charges up until 80% and depletes until it reaches 40%. This way the battery and the charger don\u0026rsquo;t get stressed all the time but rather in bursts. With the 40% lower bound i suppose in case of a blackout it would be enough to keep the server running for a while. Termux \u0026amp; Termux:Boot - Termux is a terminal app that let\u0026rsquo;s you utilise your phones capabilities or do most things you\u0026rsquo;d do in a computer terminal given that you have restricted access to the linux kernel on top of which android runs. Termux boot helps me run a simple script as soon as termux starts so I dont have to do it manually. Removing bloat Let\u0026rsquo;s start with canta and strip the phone out of almost everything. At the end of the day It\u0026rsquo;ll only be used as a server I dont care about most services that I would otherwise need like the printing service, banking identity providers and especially stuff that might be running in the background. All these together would slow down my processor ever so slightly and increase battery consumption needlessly. Then in the end I removed google play services and the play store since i don\u0026rsquo;t need any apps or services apart from the ones mentioned above and a browser which i get from F-droid. As useful as the play services are day to day, in this case they can save a ton of processing power and battery.\n!!! warning \u0026ldquo;Removing play services\u0026rdquo; Be careful when these services. Phones with tightly integrated google services like pixel phones will not be able to boot without it.\nI went straight for canta first because if you mess up the wrong system module the phone might not boot and you\u0026rsquo;d have to reinstall the operating system. Most of the time you will notice the issues right away and you can reinstall the packages though. One time while cleaning bloat from my phone there was a weird audio error where i couldn\u0026rsquo;t change the volume. After some trial and error i found out that it was caused because I removed the \u0026ldquo;Camera as Webcam\u0026rdquo; module. It really does just what it says and I have no clue how it broke audio settings but it\u0026rsquo;s staying.\nThe termuxening Termux is great, when I first installed it in high school it gave me this hackerman feeling. I was just issuing common commands like ping but it felt great. TODO: insert hackerman mr robot meme with a description literally me. Termux uses the pkg package manager which allows you to install a ton of software. The developers are great and they have improved the project a lot through the years. Now onto the main issue of typing commands in a 5 centimeter wide screen. Easily installed openssl, ran sshd and voila we\u0026rsquo;ve got ourselves an ssh server running at port 8022. Additionally I added the sshd command to the boot script.\n!!! warning \u0026ldquo;Warning\u0026rdquo; Lowest tier possible epic networking up ahead.\nSince I dont want to find out what my phone IP is everytime I want to access it remotely. So I\u0026rsquo;ll hop on to my router interface, find out that I\u0026rsquo;m accessing it through http, switch to https and block the access for http. These detours have cost me a lot of time, I\u0026rsquo;m here for another reason. After I carefully explored every single menu for fun I stumbled upon the menu that allows you to assign static IPs to devices based on the MAC address. One google search later (how to find mac address termux please) I find my phones MAC address slap it in the dialog, give it the last address of the subnet and now my phone has that address permanently in this network. For convenience one could write a small bash script in the computer that will access it mostly for the not so memorable port number.\nSetting up a virtual machine Recently I\u0026rsquo;ve discovered an app called AnLinux which makes it super easy to get a VM up and running with a couple of clicks. You can choose from a selection of distros and I chose alpine. Unluckily I couldn\u0026rsquo;t install docker because hardware virtualization isn\u0026rsquo;t supported in android out of the box so we\u0026rsquo;re missing on some critical features like cgroups. I tried using the proot termux package to bring up another VM to no avail yet again. After some very thorough research I found out that to achieve this I would have to tweak and compile the kernel myself. This surely would take some time to get right considering that compiling the entire kernel could take days in my laptop for each attempt. This made me decide that it\u0026rsquo;s not worth it because it kind of makes the entire process even more complex, although it did seem very interesting to try it. More research was done in my labs and I found a github gist that explains step by step how to install, configure and run a QEMU VM. QEMU relies on software virtualization which makes installing docker and the entire server thing possible. This is not ideal though because there\u0026rsquo;s some overhead introduced by this so the performance won\u0026rsquo;t be nearly what it could be. At the end of the process you end up running a command like this one:\nqemu-system-x86_64 -machine q35 -m 1024 -smp cpus=2 -cpu qemu64 \\ -drive if=pflash,format=raw,read-only,file=$PREFIX/share/qemu/edk2-x86_64-code.fd \\ -netdev user,id=n1,hostfwd=tcp::2222-:22 -device virtio-net,netdev=n1 \\ -nographic alpine.img In the command above you set up the parameters as it can be seen. Because I removed most apps and services before, I found out in the developer settings that I have free space so I turned up the VM memory to 2 gigs in the -m parameter. The galaxy s8 has an octacore processor which made me think that I could push the number of cores from 2 to 4 but that wasn\u0026rsquo;t the case the phone started overheating and I wouldn\u0026rsquo;t want it to run like that all the time. Point being one can play around with that parameter as long as you leave some processing power for the phone itself. In netdev you can also change the dns provider in case you run into any problems updating system software or pulling images which did happen to me. I removed the current port forward rule because I am using ssh to connect to the termux terminal and forwarded port 8080 in my phone to port 443 in the VM where a shiny nginx reverse proxy will be listening for requests.\nHello docker Now we\u0026rsquo;re in the alpine VM. I updated the preinstalled software and then i went straight ahead to install docker compose and run my first hello world container to prove that everything is running as it should. Great success! TODO: include screenshot. Here\u0026rsquo;s a simple docker compose that allows me to bring up an nginx container as a reverse proxy and trilium notes:\nversion: \u0026#34;3\u0026#34; services: trilium: image: zadam/trilium:latest container_name: trilium restart: unless-stopped networks: - frontend volumes: - /home/my-username/docker/trilium:/home/node/trilium-data nginx: image: nginx:1.27.1 container_name: nginx depends_on: - trilium networks: - frontend volumes: - ./nginx.conf:/etc/nginx/nginx.conf - ./ssl:/etc/nginx/ssl ports: - \u0026#34;80:80\u0026#34; - \u0026#34;443:443\u0026#34; restart: unless-stopped networks: frontend: driver: bridge I created a self signed certificate to avoid having trouble running services that communicate through http and bam. TODO: insert screenshot of trilium and description it wasnt all as easy as 1 2 3. I\u0026rsquo;d love to go over how cool trilium seems and how stoked I am to convert from notion to how I\u0026rsquo;d like self hosted notion to be like but it\u0026rsquo;s time to go over what I and possibly you can do with this server and more.\nWhat now? Possible services and capabilities One google search or a peek at the awesome self-hosted repo will show you infinite possibilities about what you can host there. I will however mention some essentials, personal favorites considering the possible restrictions of this setup aswell.\nPiHole - Ad blocking and tracking protection for all devices in your home network. It might speed up page loads. Trilium - Notes, graphs, calendar, note tree view, you can customize the look, add functionality with javascript and more. Jellyfin - Media streaming service. OpenVPN - Connect with your self hosted apps through your VPN. Gitea - Git service. Flame - File sharing and synchronization. Can help you setup a wetransfer like service. FileBrowser - File sharing. Grafana - System monitoring with fancy dashboards. Umami - Website analytics. Keycloak - Auth service in case you want to expose the services over the internet. Home Assistant - Home automation Tons more - You can try your luck with anything that you\u0026rsquo;d like. TV series and movie release date tracker, book reccomendations, feed readers, etc. On the other hand don\u0026rsquo;t forget that simulating vs code for a browser might be taxing for the phone. If you don\u0026rsquo;t want to keep typing something like 192.168.something.something every time you want to connect to a service you can add a DNS record that will only solve in your network in your home router (some home routers support it) or with PiHole.\nServer here or server everywhere Will my server just be accessible inside my house, outside of the house through a VPN that tunnels me to my home network or will i expose my services to the internet. Here\u0026rsquo;s some interesting options that i\u0026rsquo;ve found along the way. If you want to access the services in your home you\u0026rsquo;re already golden. If you want a VPN service to bring you home magically when you\u0026rsquo;re away you can choose tailscale as a third party service or zerotier as a mostly or totally self hosted option. No matter what you pick you\u0026rsquo;re just creating a bridge to your home network where your server resides safe and happy. If you want to expose your services to the internet for the major convenience there is a pretty good way to do so without port forwarding, DDNS, static IPs or other shenanigans. It\u0026rsquo;s called cloudflare zero trust which allows you to use cloudflares global network to connect to devices anywhere. You\u0026rsquo;d still want to encrypt your data because it\u0026rsquo;s not end to end secure but it does save you from most of the trouble of trying to safeguard a hole in your router.\nCooling Most of the time the phone stays cool but when you\u0026rsquo;re running intensive stuff it starts heating up. It\u0026rsquo;s not a problem when running services but installing stuff is of demanding. Good news is you can get a usb powered fan 140mm fan for 10 euros right?\nBackups It is generally important to have backups and backups of backups but in this case even more so, an old phone running 24/7 could go to phone heaven unexpectedly. The 3-2-1 rule seems great and while im at it i saw a 3-2-1-1-0 rule that was even safer let\u0026rsquo;s say. Either way the 3-2-1 rule stands for 3 copies of your data. One copy is on your device using the data, one in the phone server and one according to me offsite in cold storage which also solves the next part. 2 storage types we have phone server and cloud archiving storage technology (?!?). 1 off site backup (yes). Cold storage is great for such a purpose you can pay aws 1 dollar per terabyte per month. To avoid duplicating your previous backup with the new one one can use rclone or another utility which helps create incremental backups. Backup after backup you will upload only the difference from the last one. Once a week or a month should be sufficient for non critical data.\nClosing remarks This was a great journey which taught me a lot and it was great when it all came together. I also enjoyed writing this and tweaking this beautiful mkdocs website. I have to point out that I might not have covered or considered all possible issues because I haven\u0026rsquo;t used my phone server for a long time (yet). An update might be coming up in the future regarding new stuff that I\u0026rsquo;ve learned and a part two where several phone servers are used as a kubernetes cluster for learning purposes.\nThanks for sticking until the end here\u0026rsquo;s an ice cream! :icecream:\n","lang":"en","permalink":"/phone-as-a-server/","title":"Phone as a server"}]